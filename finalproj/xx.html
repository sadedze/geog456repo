<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"
   integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ=="
   crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
   integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="
   crossorigin=""></script>
   

   <script src="closures.js"></script>
</head>
<style>
    #map { 
        width: 100%;
        height: 500px;
         }
    
    /* Custom slider style */
    #dateSlider {
        -webkit-appearance: none;
        width: 100%;
        height: 15px;
        border-radius: 5px;  
        background: #d3d3d3;
        outline: none;
        opacity: 0.7;
        -webkit-transition: .2s;
        transition: opacity .2s;
    }

    #dateSlider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 25px;
        height: 25px;
        border-radius: 50%; 
        background: #04AA6D;
        cursor: pointer;
    }

    #dateSlider::-moz-range-thumb {
        width: 25px;
        height: 25px;
        border-radius: 50%;
        background: #04AA6D;
        cursor: pointer;
    }


</style>

<body>
    <h3 id="daYear">Road Closures During Hurricane Florence</h3>
    <input id="dateSlider" type="range" name="Day" min="0" max="17" oninput="moveSlider(this.value)">
    <div id="dateDisplay"></div>
    <div id="map"></div>

    
    <script>

var sliderControl = null

//create basemap
var map = L.map('map').setView([35, -76], 7);
        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: 'Â© OpenStreetMap'
        }).addTo(map);


        var geojsonData = {
  "type": "FeatureCollection",
  "features": []
};

//create geojson w data info
closures.forEach(function(dataPoint) {
  var feature = {
    "type": "Feature",
    "properties": {
      "IncidentID": dataPoint.IncidentID,
      "start": dataPoint.start,
      "end": dataPoint.end,
      "RoadName": dataPoint.RoadName,
      "CommonName": dataPoint.CommonName,
      "Direction": dataPoint.Direction,
      "ConditionName": dataPoint.ConditionName,
      "IncidentType": dataPoint.IncidentType,
      "Event": dataPoint.Event,
      "EventName": dataPoint.EventName,
      "Reason": dataPoint.Reason,
      "DOTNotes": dataPoint.DOTNotes,
      "day": dataPoint.day,
      "flood": dataPoint.flood,
      "wind": dataPoint.wind,
      "winter": dataPoint.winter,
      "fog": dataPoint.fog,
      "rainevent": dataPoint.rainevent,
      "winterevent": dataPoint.winterevent,
      "cycloneevent": dataPoint.cycloneevent,
      "dur": dataPoint.dur,
      "noweather": dataPoint.noweather,
      "st": dataPoint.st,
      "fn": dataPoint.fn,
      "t": dataPoint.t,
      "te": dataPoint.te
    },
    "geometry": {
      "type": "Point",
      "coordinates": [dataPoint.Longitude, dataPoint.Latitude]
    }
  };
  geojsonData.features.push(feature);
});

// Define a custom icon
var customIcon = L.icon({
  iconUrl: 'closedpic.jpg',
  iconSize: [10, 10],
  iconAnchor: [10, 10]
});

// Create a GeoJSON layer and add it to the map
var geojsonLayer = L.geoJson(geojsonData, {
  pointToLayer: function (feature, latlng) {
    return L.marker(latlng, { icon: customIcon });
  }
}).addTo(map);

function moveSlider(value) {
    console.log(value)
    // Remove existing markers
    map.eachLayer(function (layer) {
        if (layer instanceof L.Marker) {
            map.removeLayer(layer);
        }
    });

    // Define the start and end dates
    var startDate = new Date("2018-09-12T00:00:00Z");
    var endDate = new Date("2018-09-29T23:59:59Z");

    // Calculate the total duration in milliseconds
    var totalDuration = endDate.getTime() - startDate.getTime();

    // Calculate the selected time based on the slider value
    var selectedTime = new Date(startDate.getTime() + (totalDuration * value / 17));

    updateDateDisplay(selectedTime);

    // Iterate through each data point and add a marker if it falls within the selected range
    geojsonData.features.forEach(function (feature) {
        var startTime = new Date(feature.properties.st).getTime();
        var endTime = new Date(feature.properties.fn).getTime();
        if (selectedTime >= startTime && selectedTime <= endTime) {
            var marker = L.marker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], { icon: customIcon });
            marker.addTo(map);
        }
    });
}

function updateDateDisplay(date) {
    var dateDisplay = document.getElementById('dateDisplay');
    dateDisplay.textContent = date.toDateString(); // Display the date in a human-readable format
}

    </script>
</body>
</html>
